<!DOCTYPE html>
<html lang="de" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" th:content="#{page.description}">
    <title th:text="#{page.title}">Text Verbesserung - KI-gest√ºtzte deutsche Textoptimierung</title>
    <script src="https://cdn.jsdelivr.net/npm/diff@5.1.0/dist/diff.min.js" 
            integrity="sha384-kfJm1UHujU89hXr0VHT0u0t4lqavqaoomP6wix8D9fhzTeFvC9DYyaT36//Qd144" 
            crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <a href="#main-content" class="skip-link" th:text="#{accessibility.skipToMainContent}">Zum Hauptinhalt springen</a>
    
    <!-- Top Choosers -->
    <div class="top-choosers">
        <!-- Theme Chooser -->
        <div class="theme-chooser">
            <button type="button" class="theme-btn" id="light-theme-btn"
                    onclick="switchTheme('light')"
                    th:title="#{theme.title.light}"
                    th:text="#{theme.light}">Hell</button>
            <button type="button" class="theme-btn" id="dark-theme-btn"
                    onclick="switchTheme('dark')"
                    th:title="#{theme.title.dark}"
                    th:text="#{theme.dark}">Dunkel</button>
        </div>
        
        <!-- Language Chooser -->
        <div class="language-chooser">
            <button type="button" class="lang-btn" 
                    th:classappend="${#locale.language == 'de'} ? 'active' : ''" 
                    onclick="switchLanguage('de')"
                    title="Deutsch">DE</button>
            <button type="button" class="lang-btn" 
                    th:classappend="${#locale.language == 'en'} ? 'active' : ''" 
                    onclick="switchLanguage('en')"
                    title="English">EN</button>
        </div>
    </div>


    <div class="container">
        <header class="header" role="banner">
            <h1 th:text="#{header.title}">‚ú® Text Verbesserung</h1>
        </header>
        <main id="main-content" class="content" role="main">
        
        <form th:action="@{/improve}" method="post" onsubmit="showLoading()" role="form" aria-labelledby="form-heading">
            <h2 id="form-heading" class="visually-hidden" th:text="#{accessibility.visuallyHiddenFormHeading}">Textverbesserung</h2>
            <div class="form-group">
                <div class="textarea-header">
                    <label for="inputText" th:text="#{form.inputText.label}">Text (Deutsch):</label>
                    <div class="textarea-buttons">
                        <button type="button" class="textarea-btn clear-btn" onclick="clearTextarea()" th:title="#{form.inputText.clear.title}">
                            <svg viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                                <path d="M5.28 4.22a.75.75 0 0 0-1.06 1.06L6.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L8 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L9.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L8 6.94 5.28 4.22Z"/>
                            </svg>
                            <span th:text="#{form.inputText.clear}">L√∂schen</span>
                        </button>
                        <button type="button" class="textarea-btn paste-btn" onclick="pasteToTextarea()" th:title="#{form.inputText.paste.title}">
                            <svg viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M4 1.75C4 .784 4.784 0 5.75 0h4.5C11.216 0 12 .784 12 1.75v1.5c0 .216-.168.389-.375.389H4.375A.378.378 0 0 1 4 3.25V1.75ZM5.75 1.5a.25.25 0 0 0-.25.25v.75c0 .138.112.25.25.25h4.5a.25.25 0 0 0 .25-.25v-.75a.25.25 0 0 0-.25-.25h-4.5ZM2 4.75C2 3.784 2.784 3 3.75 3H4v.389c0 .872.728 1.611 1.625 1.611h4.75c.897 0 1.625-.739 1.625-1.611V3h.25C13.216 3 14 3.784 14 4.75v8.5A1.75 1.75 0 0 1 12.25 15h-8.5A1.75 1.75 0 0 1 2 13.25v-8.5ZM3.75 4.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-8.5a.25.25 0 0 0-.25-.25h-8.5Z"/>
                            </svg>
                            <span th:text="#{form.inputText.paste}">Einf√ºgen</span>
                        </button>
                    </div>
                </div>
                <div class="textarea-container">
                    <textarea 
                        id="inputText" 
                        name="inputText" 
                        th:placeholder="#{form.inputText.placeholder}"
                        th:text="${inputText}"
                        required
                        aria-describedby="inputText-help"
                        aria-invalid="false"></textarea>
                </div>
                <div id="inputText-help" class="visually-hidden" th:text="#{accessibility.visuallyHiddenInputHelp}">Geben Sie den deutschen Text ein, den Sie verbessern m√∂chten</div>
            </div>
            
            <div class="form-group">
                <div class="prompt-header">
                    <div class="model-selection">
                        <span class="model-label" id="model-label" th:text="#{form.modelSelection.label}">KI-Modell:</span>
                        <button type="button" id="current-model-display" class="current-model" onclick="toggleModelSelection()" th:text="${selectedModel}" th:title="#{form.modelSelection.title}" aria-describedby="model-label" aria-expanded="false" aria-haspopup="listbox">gpt-4</button>
                        <select id="selectedModel" name="selectedModel" class="model-select-hidden" style="display: none;" aria-labelledby="model-label">
                            <option th:each="model : ${availableModels}" 
                                    th:value="${model}" 
                                    th:text="${model}"
                                    th:selected="${model == selectedModel}"></option>
                        </select>
                    </div>
                    <button type="button" class="prompt-toggle-btn" onclick="togglePromptVisibility()" th:title="#{form.promptToggle.title}" aria-expanded="false" aria-controls="prompt-container">
                        ‚öôÔ∏è <span id="prompt-toggle-text" th:text="#{form.promptToggle.show}">Prompt anzeigen</span>
                    </button>
                </div>
                <div id="prompt-container" class="prompt-container" style="display: none;" role="region" aria-labelledby="prompt-heading">
                    <label for="customPrompt" id="prompt-heading" class="visually-hidden" th:text="#{accessibility.visuallyHiddenPromptHeading}">Benutzerdefinierter Prompt</label>
                    <textarea 
                        id="customPrompt" 
                        name="customPrompt" 
                        class="prompt-textarea"
                        th:placeholder="#{form.customPrompt.placeholder}"
                        aria-describedby="prompt-help"
                        th:text="${customPrompt}">Du bist ein professioneller Texteditor und Schreibcoach f√ºr die deutsche Sprache. 

WICHTIG: Gib ausschlie√ülich den verbesserten Text aus - ohne Erkl√§rungen, Kommentare, Emojis, Markdown oder sonstige Zus√§tze.

Verbessere den folgenden deutschen Text, indem du:
1. Grammatik und Rechtschreibung korrigierst
2. Den Stil und die Lesbarkeit verbesserst
3. Klarheit und Pr√§zision erh√∂hst
4. Den Ton professioneller und ansprechender machst
5. Die Struktur optimierst

Behalte dabei den urspr√ºnglichen Sinn und die Intention des Textes bei.
Behalte die urspr√ºngliche Struktur und Formatierung (Abs√§tze, Listen) bei.

Urspr√ºnglicher Text:
{input_text}

Verbesserter Text (nur der Text, keine Erkl√§rungen):</textarea>
                    <div id="prompt-help" class="visually-hidden" th:text="#{accessibility.visuallyHiddenPromptHelp}">Anpassung des KI-Prompts f√ºr die Textverbesserung</div>
                </div>
            </div>
            
            <button type="submit" class="btn" id="submitBtn" aria-describedby="loading" th:text="#{form.submit.button}">üöÄ Text verbessern</button>
            <div class="loading" id="loading" role="status" aria-live="polite" aria-atomic="true" th:text="#{loading.processing}">‚è≥ Text wird verarbeitet...</div>
            
            <div th:if="${error}" class="error" role="alert" aria-live="assertive" th:text="${error}"></div>
        </form>

        <section th:if="${improvedText}" class="result-section" role="region" aria-labelledby="results-heading">
            <div class="result-header">
                <h2 id="results-heading" th:text="#{results.heading}">Verbesserter Text:</h2>
                <button type="button" class="copy-button" onclick="copyToClipboard()" 
                        aria-label="Copy improved text to clipboard" 
                        th:aria-label="#{results.copy.button}"
                        id="copyButton">
                    <svg class="copy-icon" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                        <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"/>
                        <path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"/>
                    </svg>
                    <span th:text="#{results.copy.button}">In Zwischenablage kopieren</span>
                </button>
            </div>
            <div class="result-text" th:text="${improvedText}" role="textbox" aria-readonly="true" tabindex="0" id="resultText"></div>
            
            <div style="margin-top: 30px;">
                <h3 id="diff-heading" th:text="#{results.diff.heading}">üîç Detaillierte √Ñnderungen:</h3>
                <div class="diff-controls" role="tablist" aria-labelledby="diff-heading">
                    <button type="button" class="diff-toggle-btn active" data-mode="side-by-side" onclick="toggleDiffMode('side-by-side')" role="tab" aria-selected="true" aria-controls="diff-container" id="tab-side-by-side" th:text="#{results.diff.sideBySide}">Nebeneinander</button>
                    <button type="button" class="diff-toggle-btn" data-mode="unified" onclick="toggleDiffMode('unified')" role="tab" aria-selected="false" aria-controls="diff-container" id="tab-unified" th:text="#{results.diff.unified}">Vereinheitlicht</button>
                </div>
                <div id="diff-container" class="diff-container" role="tabpanel" aria-labelledby="tab-side-by-side">
                    <!-- Diff will be rendered here by JavaScript -->
                </div>
            </div>
            
            
            <!-- Hidden elements for JavaScript to access the texts -->
            <div id="original-text" style="display: none;" th:text="${inputText}"></div>
            <div id="improved-text" style="display: none;" th:text="${improvedText}"></div>
        </section>
        </main>
    </div>

    <script th:inline="javascript">
        // Internationalized messages for JavaScript
        window.messages = {
            'form.submit.processing': /*[[#{form.submit.processing}]]*/ '‚è≥ Verarbeitung l√§uft...',
            'loading.processingWait': /*[[#{loading.processingWait}]]*/ 'Text wird verarbeitet. Bitte warten...',
            'error.emptyText': /*[[#{error.emptyText}]]*/ 'Bitte geben Sie einen Text ein, der verbessert werden soll.',
            'error.minLength': /*[[#{error.minLength}]]*/ 'Der Text muss mindestens 3 Zeichen lang sein.',
            'error.maxLength': /*[[#{error.maxLength}]]*/ 'Der Text darf maximal 10.000 Zeichen lang sein.',
            'error.diffLibraryNotLoaded': /*[[#{error.diffLibraryNotLoaded}]]*/ 'Diff library not loaded. Please refresh the page.',
            'form.promptToggle.hide': /*[[#{form.promptToggle.hide}]]*/ 'Prompt ausblenden',
            'form.promptToggle.show': /*[[#{form.promptToggle.show}]]*/ 'Prompt anzeigen',
            'results.diff.originalText': /*[[#{results.diff.originalText}]]*/ 'Originaltext',
            'results.diff.improvedText': /*[[#{results.diff.improvedText}]]*/ 'Verbesserter Text',
            'results.copy.button': /*[[#{results.copy.button}]]*/ 'In Zwischenablage kopieren',
            'results.copy.success': /*[[#{results.copy.success}]]*/ 'Text kopiert!',
            'results.copy.error': /*[[#{results.copy.error}]]*/ 'Kopieren fehlgeschlagen',
            'announce.promptOpened': /*[[#{announce.promptOpened}]]*/ 'Prompt-Bereich ge√∂ffnet',
            'announce.promptClosed': /*[[#{announce.promptClosed}]]*/ 'Prompt-Bereich geschlossen',
            'announce.modelSelectionOpened': /*[[#{announce.modelSelectionOpened}]]*/ 'Modellauswahl ge√∂ffnet',
            'announce.modelSelected': /*[[#{announce.modelSelected}]]*/ 'Modell gew√§hlt: {0}',
            'announce.diffModeChanged.sideBySide': /*[[#{announce.diffModeChanged.sideBySide}]]*/ 'Ansicht gewechselt zu Nebeneinander',
            'announce.diffModeChanged.unified': /*[[#{announce.diffModeChanged.unified}]]*/ 'Ansicht gewechselt zu Vereinheitlicht',
            'announce.textImprovementCompleted': /*[[#{announce.textImprovementCompleted}]]*/ 'Textverbesserung abgeschlossen. Ergebnisse verf√ºgbar.',
            'announce.error': /*[[#{announce.error}]]*/ 'Fehler: {0}',
            'form.inputText.clear': /*[[#{form.inputText.clear}]]*/ 'L√∂schen',
            'form.inputText.paste': /*[[#{form.inputText.paste}]]*/ 'Einf√ºgen',
            'form.inputText.paste.success': /*[[#{results.copy.success}]]*/ 'Text kopiert!',
            'form.inputText.paste.error': /*[[#{results.copy.error}]]*/ 'Kopieren fehlgeschlagen'
        };
    </script>
    <script th:src="@{/js/main.js}"></script>
</body>
</html>