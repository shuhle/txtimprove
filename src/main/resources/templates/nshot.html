<!DOCTYPE html>
<html lang="de" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" th:content="#{nshot.page.description}">
    <title th:text="#{nshot.page.title}">N-Shot Prompting - KI-gest√ºtzte Lernbeispiele</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <a href="#main-content" class="skip-link" th:text="#{accessibility.skipToMainContent}">Zum Hauptinhalt springen</a>
    
    <!-- Top Choosers -->
    <div class="top-choosers">
        <!-- Theme Chooser -->
        <div class="theme-chooser">
            <button type="button" class="theme-btn" id="light-theme-btn"
                    onclick="switchTheme('light')"
                    th:title="#{theme.title.light}"
                    th:text="#{theme.light}">Hell</button>
            <button type="button" class="theme-btn" id="dark-theme-btn"
                    onclick="switchTheme('dark')"
                    th:title="#{theme.title.dark}"
                    th:text="#{theme.dark}">Dunkel</button>
        </div>
        
        <!-- Language Chooser -->
        <div class="language-chooser">
            <button type="button" class="lang-btn" 
                    th:classappend="${#locale.language == 'de'} ? 'active' : ''" 
                    onclick="switchLanguage('de')"
                    title="Deutsch">DE</button>
            <button type="button" class="lang-btn" 
                    th:classappend="${#locale.language == 'en'} ? 'active' : ''" 
                    onclick="switchLanguage('en')"
                    title="English">EN</button>
        </div>
    </div>

    <!-- Back Button -->
    <div class="back-button-container">
        <a href="/" class="back-button" th:title="#{navigation.back.title}">
            <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.42-1.41L7.83 13H20v-2z"/>
            </svg>
            <span th:text="#{navigation.back}">Zur√ºck</span>
        </a>
    </div>

    <div class="container">
        <header class="header" role="banner">
            <h1 th:text="#{nshot.header.title}">üéØ N-Shot Prompting</h1>
            <p class="subtitle" th:text="#{nshot.header.subtitle}">KI-Lernen durch Beispiele</p>
        </header>
        <main id="main-content" class="content" role="main">
        
        <form th:action="@{/nshot}" method="post" onsubmit="showLoading()" role="form" aria-labelledby="form-heading">
            <h2 id="form-heading" class="visually-hidden" th:text="#{accessibility.visuallyHiddenFormHeading}">N-Shot Prompting</h2>
            
            <!-- Example Shots Section -->
            <div id="shots-container">
                <h3 th:text="#{nshot.form.examples.heading}">Beispiele (Shots):</h3>
                
                <!-- Dynamic shot pairs based on server data -->
                <div th:if="${problems != null and solutions != null}" th:each="shot, shotStat : ${problems}" class="shot-pair" th:attr="data-shot-index=${shotStat.index}">
                    <div class="shot-header">
                        <h4 th:text="#{nshot.form.example} + ' ' + ${shotStat.index + 1}">Beispiel 1</h4>
                        <button type="button" class="remove-shot-btn" th:onclick="'removeShot(' + ${shotStat.index} + ')'" th:title="#{nshot.form.removeExample.title}" th:style="${shotStat.index == 0 and #lists.size(problems) == 1} ? 'display: none;' : ''">
                            ‚ùå
                        </button>
                    </div>
                    
                    <div class="shot-inputs">
                        <div class="form-group shot-input-half">
                            <label th:for="'problem_' + ${shotStat.index}" th:text="#{nshot.form.problem.label}">Problem:</label>
                            <textarea 
                                th:id="'problem_' + ${shotStat.index}"
                                name="problems"
                                th:value="${shot}"
                                th:placeholder="#{nshot.form.problem.placeholder}"
                                required
                                rows="3"
                                aria-describedby="problem-help"
                                aria-invalid="false"
                                th:text="${shot}"></textarea>
                            <div id="problem-help" class="visually-hidden" th:text="#{accessibility.visuallyHiddenProblemHelp}">Geben Sie das Problem oder die Eingabe f√ºr dieses Beispiel ein</div>
                        </div>
                        
                        <div class="form-group shot-input-half">
                            <label th:for="'solution_' + ${shotStat.index}" th:text="#{nshot.form.solution.label}">L√∂sung:</label>
                            <textarea 
                                th:id="'solution_' + ${shotStat.index}"
                                name="solutions"
                                th:value="${solutions[shotStat.index]}"
                                th:placeholder="#{nshot.form.solution.placeholder}"
                                required
                                rows="3"
                                aria-describedby="solution-help"
                                aria-invalid="false"
                                th:text="${solutions[shotStat.index]}"></textarea>
                            <div id="solution-help" class="visually-hidden" th:text="#{accessibility.visuallyHiddenSolutionHelp}">Geben Sie die erwartete L√∂sung f√ºr dieses Beispiel ein</div>
                        </div>
                    </div>
                </div>
                
                <!-- Default shot pair if no data from server -->
                <div th:if="${problems == null or solutions == null}" class="shot-pair" data-shot-index="0">
                    <div class="shot-header">
                        <h4 th:text="#{nshot.form.example} + ' 1'">Beispiel 1</h4>
                        <button type="button" class="remove-shot-btn" onclick="removeShot(0)" th:title="#{nshot.form.removeExample.title}" style="display: none;">
                            ‚ùå
                        </button>
                    </div>
                    
                    <div class="shot-inputs">
                        <div class="form-group shot-input-half">
                            <label for="problem_0" th:text="#{nshot.form.problem.label}">Problem:</label>
                            <textarea 
                                id="problem_0"
                                name="problems"
                                th:placeholder="#{nshot.form.problem.placeholder}"
                                required
                                rows="3"
                                aria-describedby="problem-help"
                                aria-invalid="false"></textarea>
                            <div id="problem-help" class="visually-hidden" th:text="#{accessibility.visuallyHiddenProblemHelp}">Geben Sie das Problem oder die Eingabe f√ºr dieses Beispiel ein</div>
                        </div>
                        
                        <div class="form-group shot-input-half">
                            <label for="solution_0" th:text="#{nshot.form.solution.label}">L√∂sung:</label>
                            <textarea 
                                id="solution_0"
                                name="solutions"
                                th:placeholder="#{nshot.form.solution.placeholder}"
                                required
                                rows="3"
                                aria-describedby="solution-help"
                                aria-invalid="false"></textarea>
                            <div id="solution-help" class="visually-hidden" th:text="#{accessibility.visuallyHiddenSolutionHelp}">Geben Sie die erwartete L√∂sung f√ºr dieses Beispiel ein</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Add/Remove Shot Controls -->
            <div class="shot-controls">
                <button type="button" class="add-shot-btn" onclick="addShot()" th:text="#{nshot.form.addExample.button}">
                    ‚ûï Beispiel hinzuf√ºgen
                </button>
            </div>
            
            <!-- New Problem Section -->
            <div class="form-group">
                <label for="newProblem" th:text="#{nshot.form.newProblem.label}">Neues Problem:</label>
                <textarea 
                    id="newProblem" 
                    name="newProblem" 
                    th:placeholder="#{nshot.form.newProblem.placeholder}"
                    th:text="${newProblem}"
                    required
                    rows="4"
                    aria-describedby="newProblem-help"
                    aria-invalid="false"></textarea>
                <div id="newProblem-help" class="visually-hidden" th:text="#{accessibility.visuallyHiddenNewProblemHelp}">Geben Sie das neue Problem ein, f√ºr das die KI eine L√∂sung generieren soll</div>
            </div>
            
            <div class="form-group">
                <div class="prompt-header">
                    <div class="model-selection">
                        <span class="model-label" id="model-label" th:text="#{form.modelSelection.label}">KI-Modell:</span>
                        <button type="button" id="current-model-display" class="current-model" onclick="toggleModelSelection()" th:text="${selectedModel}" th:title="#{form.modelSelection.title}" aria-describedby="model-label" aria-expanded="false" aria-haspopup="listbox">gpt-4</button>
                        <select id="selectedModel" name="selectedModel" class="model-select-hidden" style="display: none;" aria-labelledby="model-label">
                            <option th:each="model : ${availableModels}" 
                                    th:value="${model}" 
                                    th:text="${model}"
                                    th:selected="${model == selectedModel}"></option>
                        </select>
                    </div>
                    <button type="button" class="prompt-toggle-btn" onclick="togglePromptVisibility()" th:title="#{form.promptToggle.title}" aria-expanded="false" aria-controls="prompt-container">
                        ‚öôÔ∏è <span id="prompt-toggle-text" th:text="#{form.promptToggle.show}">Prompt anzeigen</span>
                    </button>
                </div>
                <div id="prompt-container" class="prompt-container" style="display: none;" role="region" aria-labelledby="prompt-heading">
                    <label for="customPrompt" id="prompt-heading" class="visually-hidden" th:text="#{accessibility.visuallyHiddenPromptHeading}">Benutzerdefinierter Prompt</label>
                    <textarea 
                        id="customPrompt" 
                        name="customPrompt" 
                        class="prompt-textarea"
                        th:placeholder="#{nshot.form.customPrompt.placeholder}"
                        aria-describedby="prompt-help"
                        th:text="${customPrompt}">Du bist ein intelligenter Assistent, der aus Beispielen lernt und √§hnliche Aufgaben l√∂st.

WICHTIG: Gib ausschlie√ülich die L√∂sung aus - ohne Erkl√§rungen, Kommentare, Emojis, Markdown oder sonstige Zus√§tze.

Hier sind einige Beispiele:

{examples}

L√∂se nun diese Aufgabe nach dem gleichen Muster:

Problem: {new_problem}

L√∂sung (nur die L√∂sung, keine Erkl√§rungen):</textarea>
                    <div id="prompt-help" class="visually-hidden" th:text="#{accessibility.visuallyHiddenPromptHelp}">Anpassung des KI-Prompts f√ºr N-Shot Learning</div>
                </div>
            </div>
            
            <button type="submit" class="btn" id="submitBtn" aria-describedby="loading" th:text="#{nshot.form.submit.button}">üöÄ L√∂sung generieren</button>
            <div class="loading" id="loading" role="status" aria-live="polite" aria-atomic="true" th:text="#{loading.processing}">‚è≥ Text wird verarbeitet...</div>
            
            <div th:if="${error}" class="error" role="alert" aria-live="assertive" th:text="${error}"></div>
        </form>

        <section th:if="${generatedSolution}" class="result-section" role="region" aria-labelledby="results-heading">
            <div class="result-header">
                <h2 id="results-heading" th:text="#{nshot.results.heading}">Generierte L√∂sung:</h2>
                <button type="button" class="copy-button" onclick="copyToClipboard()" 
                        aria-label="Copy generated solution to clipboard" 
                        th:aria-label="#{results.copy.button}"
                        id="copyButton">
                    <svg class="copy-icon" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                        <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"/>
                        <path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"/>
                    </svg>
                    <span th:text="#{results.copy.button}">In Zwischenablage kopieren</span>
                </button>
            </div>
            <div class="result-text" th:text="${generatedSolution}" role="textbox" aria-readonly="true" tabindex="0" id="resultText"></div>
        </section>
        </main>
    </div>

    <!-- Hidden elements for JavaScript to access translated messages -->
    <span id="msg-example" style="display: none;" th:text="#{nshot.form.example}">Beispiel</span>
    <span id="msg-remove-title" style="display: none;" th:text="#{nshot.form.removeExample.title}">Beispiel entfernen</span>
    <span id="msg-problem-label" style="display: none;" th:text="#{nshot.form.problem.label}">Problem:</span>
    <span id="msg-solution-label" style="display: none;" th:text="#{nshot.form.solution.label}">L√∂sung:</span>
    <span id="msg-problem-placeholder" style="display: none;" th:text="#{nshot.form.problem.placeholder}">Geben Sie das Problem ein...</span>
    <span id="msg-solution-placeholder" style="display: none;" th:text="#{nshot.form.solution.placeholder}">Geben Sie die L√∂sung ein...</span>

    <script th:inline="javascript">
        // Internationalized messages for JavaScript
        var messages = {
            'form.submit.processing': /*[[#{form.submit.processing}]]*/ '‚è≥ Verarbeitung l√§uft...',
            'loading.processingWait': /*[[#{loading.processingWait}]]*/ 'Text wird verarbeitet. Bitte warten...',
            'error.emptyText': /*[[#{error.emptyText}]]*/ 'Bitte geben Sie einen Text ein, der verbessert werden soll.',
            'error.minLength': /*[[#{error.minLength}]]*/ 'Der Text muss mindestens 3 Zeichen lang sein.',
            'error.maxLength': /*[[#{error.maxLength}]]*/ 'Der Text darf maximal 10.000 Zeichen lang sein.',
            'form.promptToggle.hide': /*[[#{form.promptToggle.hide}]]*/ 'Prompt ausblenden',
            'form.promptToggle.show': /*[[#{form.promptToggle.show}]]*/ 'Prompt anzeigen',
            'results.copy.button': /*[[#{results.copy.button}]]*/ 'In Zwischenablage kopieren',
            'results.copy.success': /*[[#{results.copy.success}]]*/ 'Text kopiert!',
            'results.copy.error': /*[[#{results.copy.error}]]*/ 'Kopieren fehlgeschlagen',
            'announce.promptOpened': /*[[#{announce.promptOpened}]]*/ 'Prompt-Bereich ge√∂ffnet',
            'announce.promptClosed': /*[[#{announce.promptClosed}]]*/ 'Prompt-Bereich geschlossen',
            'announce.modelSelectionOpened': /*[[#{announce.modelSelectionOpened}]]*/ 'Modellauswahl ge√∂ffnet',
            'announce.modelSelected': /*[[#{announce.modelSelected}]]*/ 'Modell gew√§hlt: {0}',
            'announce.error': /*[[#{announce.error}]]*/ 'Fehler: {0}',
            'nshot.form.example': /*[[#{nshot.form.example}]]*/ 'Beispiel',
            'nshot.form.removeExample.title': /*[[#{nshot.form.removeExample.title}]]*/ 'Beispiel entfernen'
        };
        
        // Will be initialized in DOMContentLoaded
        let shotIndex = 1;
        
        function addShot() {
            const container = document.getElementById('shots-container');
            const shotDiv = document.createElement('div');
            shotDiv.className = 'shot-pair';
            shotDiv.setAttribute('data-shot-index', shotIndex);
            
            // Get translated messages from hidden elements
            const exampleText = document.getElementById('msg-example').textContent;
            const removeTitle = document.getElementById('msg-remove-title').textContent;
            const problemLabel = document.getElementById('msg-problem-label').textContent;
            const solutionLabel = document.getElementById('msg-solution-label').textContent;
            const problemPlaceholder = document.getElementById('msg-problem-placeholder').textContent;
            const solutionPlaceholder = document.getElementById('msg-solution-placeholder').textContent;
            
            shotDiv.innerHTML = `
                <div class="shot-header">
                    <h4>${exampleText} ${shotIndex + 1}</h4>
                    <button type="button" class="remove-shot-btn" onclick="removeShot(${shotIndex})" title="${removeTitle}">
                        ‚ùå
                    </button>
                </div>
                
                <div class="shot-inputs">
                    <div class="form-group shot-input-half">
                        <label for="problem_${shotIndex}">${problemLabel}</label>
                        <textarea 
                            id="problem_${shotIndex}"
                            name="problems"
                            placeholder="${problemPlaceholder}"
                            required
                            rows="3"
                            aria-describedby="problem-help"
                            aria-invalid="false"></textarea>
                    </div>
                    
                    <div class="form-group shot-input-half">
                        <label for="solution_${shotIndex}">${solutionLabel}</label>
                        <textarea 
                            id="solution_${shotIndex}"
                            name="solutions"
                            placeholder="${solutionPlaceholder}"
                            required
                            rows="3"
                            aria-describedby="solution-help"
                            aria-invalid="false"></textarea>
                    </div>
                </div>
            `;
            
            container.appendChild(shotDiv);
            shotIndex++;
            
            // Show remove buttons for all shots when there are more than one
            updateRemoveButtons();
        }
        
        function removeShot(index) {
            const shotElement = document.querySelector(`[data-shot-index="${index}"]`);
            if (shotElement) {
                shotElement.remove();
                updateRemoveButtons();
                updateShotNumbers();
            }
        }
        
        function updateRemoveButtons() {
            const shots = document.querySelectorAll('.shot-pair');
            const removeButtons = document.querySelectorAll('.remove-shot-btn');
            
            // Show remove buttons only if there are more than one shot
            removeButtons.forEach(btn => {
                btn.style.display = shots.length > 1 ? 'block' : 'none';
            });
        }
        
        function updateShotNumbers() {
            const shots = document.querySelectorAll('.shot-pair');
            const exampleText = document.getElementById('msg-example').textContent;
            shots.forEach((shot, index) => {
                const header = shot.querySelector('h4');
                if (header) {
                    header.textContent = `${exampleText} ${index + 1}`;
                }
            });
        }
        
        // Initialize remove button visibility and shot index
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize shotIndex based on existing shots
            shotIndex = document.querySelectorAll('.shot-pair').length;
            updateRemoveButtons();
        });
    </script>
    <script th:src="@{/js/main.js}"></script>
</body>
</html>